@*
 * Copyright 2024 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.apiplatformorganisationfrontend.controllers.routes
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import uk.gov.hmrc.apiplatform.modules.tpd.session.domain.models.UserSession
@import uk.gov.hmrc.apiplatformorganisationfrontend.models.views.Crumb
@import uk.gov.hmrc.apiplatformorganisationfrontend.controllers.ApplicationController.ManageApplicationsViewModel
@import uk.gov.hmrc.apiplatformorganisationfrontend.views.html.Layout
@import uk.gov.hmrc.apiplatformorganisationfrontend.controllers.ApplicationController.AppViewModel
@import uk.gov.hmrc.apiplatformorganisationfrontend.controllers.ApplicationController.SelectedAppsForm
@import uk.gov.hmrc.apiplatformorganisationfrontend.views.html.include.fieldError

@this(layout: Layout,
govukButton: GovukButton)

@(loggedInSession: Option[UserSession], form: Form[SelectedAppsForm], manageApplicationsViewModel: ManageApplicationsViewModel)(implicit request: RequestHeader, messages: Messages, appConfig: AppConfig)

@layout(
    crumbs = Seq(Crumb.home),
    pageTitle = s"Which of these software applications does ${manageApplicationsViewModel.organisationName} own?",
    loggedInSession = loggedInSession
) {

    @helper.form(action = uk.gov.hmrc.apiplatformorganisationfrontend.controllers.routes.ApplicationController.addApplicationsAction(manageApplicationsViewModel.organisationId), Symbol("class") -> "form") {
        @helper.CSRF.formField

        <div class="govuk-form-group @if(form.errors.map(_.message).contains("You must select at least one application")) {govuk-form-group--error}">
            <fieldset class="govuk-fieldset" aria-describedby="mass-hint app-not-selected-error">
                <legend class="govuk-fieldset__legend govuk-fieldset__legend--l ">
                    <span class="govuk-caption-l">Your software applications</span>
                    <h1 class="govuk-fieldset__heading">
                        Which of these software applications does @manageApplicationsViewModel.organisationName own?
                    </h1>
                </legend>

                @if(form.errors.map(_.message).contains("You must select at least one application")) {
                    <span id="app-not-selected-error" class="govuk-error-message">
                        <span class="govuk-visually-hidden">Error:</span> You must select at least one application
                    </span>
                }

                <div class="govuk-checkboxes govuk-checkboxes--inline">
                    <span id="add-principal-app-error" class="govuk-error-message">
                        <span class="govuk-visually-hidden">Error:</span> @fieldError(form.errors, "selectedPrincipalApps[]")
                    </span>
                    <span id="add-subordinate-app-error" class="govuk-error-message">
                        <span class="govuk-visually-hidden">Error:</span> @fieldError(form.errors, "selectedSubordinateApps[]")
                    </span>


                    <h2 class="govuk-heading-s govuk-!-margin-top-6">Production environment</h2>
                    @for(app: AppViewModel <- manageApplicationsViewModel.principalApps){
                        <div class="govuk-checkboxes__item">
                            <input class="govuk-checkboxes__input" id="@app.appId.toString" name="selectedPrincipalApps[]" type="checkbox" value="@app.appId.toString" @if(form.data.contains(app.appId.toString)) {checked}>
                            <label class="govuk-label govuk-checkboxes__label" for="@app.appId">
                                @app.appName
                            </label>
                        </div>
                    }

                    <h2 class="govuk-heading-s govuk-!-margin-top-6">Sandbox environment</h2>

                    @for(app: AppViewModel <- manageApplicationsViewModel.subordinateApps){
                        <div class="govuk-checkboxes__item">
                            <input class="govuk-checkboxes__input" id="@app.appId.toString" name="selectedSubordinateApps[]" type="checkbox" value="@app.appId.toString">
                            <label class="govuk-label govuk-checkboxes__label" for="@app.appId">
                            @app.appName
                            </label>
                        </div>
                    }

                </div>
            </fieldset>
        </div>

        <div class="govuk-button-group">
            <button class="govuk-button" data-module="govuk-button" data-govuk-button-init="">Save and continue </button>
        </div>
    }
}
